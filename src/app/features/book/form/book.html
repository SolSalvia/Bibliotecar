<div class="page-container">
  <form [formGroup]="form" (ngSubmit)="submit()">

<!-- FORMULARIO DE ALTA -->
<form [formGroup]="form" (ngSubmit)="submit()" style="display:grid;gap:12px;max-width:520px;margin-bottom:24px;">
  <h2>Alta de Libro</h2>

  <!-- ISBN -->
  <div class="form-field">
    <label for="isbn">ISBN</label>
    <input type="text" id="isbn" formControlName="isbn" placeholder="978..." />

    @let isbn = f.isbn;

    @if (isbn?.pending) {
      <small>Verificando ISBN...</small>
    }

    @if (isbn && (isbn.dirty || isbn.touched) && isbn.invalid) {
      @if (isbn.hasError('required')) {
        <span class="errors">El ISBN es requerido</span>
      } @else if (isbn.hasError('isbnInvalid')) {
        <span class="errors">ISBN inválido (10 o 13 con dígito verificador)</span>
      } @else if (isbn.hasError('isbnTaken')) {
        <span class="errors">El ISBN ya existe</span>
      }
    }
  </div>

  <!-- TÍTULO -->
  <div class="form-field">
    <label for="title">Título</label>
    <input type="text" id="title" formControlName="title" placeholder="Harry Potter y la piedra filosofal" />

    @let title = f.title;
    @if (title && (title.dirty || title.touched) && title.invalid) {
      @if (title.hasError('required')) {
        <span class="errors">El título es requerido</span>
      }
    }
  </div>

  <!-- AUTOR -->
  <div class="form-field">
    <label for="author">Autor</label>
    <input type="text" id="author" formControlName="author" placeholder="J.K. Rowling" />

    @let author = f.author;
    @if (author && (author.dirty || author.touched) && author.invalid) {
      @if (author.hasError('required')) {
        <span class="errors">El autor es requerido</span>
      }
    }
  </div>

  <!-- CATEGORÍA (opcional) -->
  <div class="form-field">
    <label for="category">Categoría</label>
    <select id="category" formControlName="category">
      <option value="" disabled selected>Seleccione una categoría</option>
      @for (category of categories; track $index) {
          <option [value]="category">{{ category }}</option>
      }
    </select>
  </div>

  <!-- AÑO PUBLICACIÓN -->
  <div class="form-field">
    <label for="publicationYear">Año de publicación</label>
    <input type="number" id="publicationYear" formControlName="publicationYear" [attr.max]="currentYear" min="1450" />

    @let py = f.publicationYear;
    @if (py && (py.dirty || py.touched) && py.invalid) {
      @if (py.hasError('yearInvalid')) {
        <span class="errors">Año inválido</span>
      } @else if (py.hasError('yearOutOfRange')) {
        <span class="errors">Debe estar entre {{ py.errors?.['yearOutOfRange'].min }} y {{ py.errors?.['yearOutOfRange'].max }}</span>
      } @else if (py.hasError('required')) {
        <span class="errors">Requerido</span>
      }
    }
  </div>

  <!-- COPIAS TOTALES -->
  <div class="form-field">
    <label for="totalCopies">Copias totales</label>
    <input type="number" id="totalCopies" formControlName="totalCopies" placeholder="1" min="1" />

    @let tc = f.totalCopies;
    @if (tc && (tc.dirty || tc.touched) && tc.invalid) {
      @if (tc.hasError('required')) {
        <span class="errors">Las copias totales son requeridas</span>
      } @else if (tc.hasError('min')) {
        <span class="errors">Las copias totales deben ser al menos 1</span>
      }
    }
  </div>

  <!-- ACTIVO -->
  <div class="form-field" style="display:flex;align-items:center;gap:8px;">
    <input type="checkbox" id="isActive" formControlName="isActive" />
    <label for="isActive" style="margin:0;">Activo</label>
  </div>

  <div style="display:flex;gap:8px;margin-top:8px">
    <button type="submit" [disabled]="form.invalid || form.pending">Guardar</button>
    <button type="button" (click)="form.reset({publicationYear: currentYear, totalCopies: 1, isActive: true})">Limpiar</button>
  </div>
</form>

<!-- Mensaje de éxito -->
<div *ngIf="successMessage" class="success-message">
  {{ successMessage }}
</div>
  </form>
</div>